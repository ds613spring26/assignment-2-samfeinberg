---
title: "lubridate"
format: html
editor: visual
author: Sam Feinberg
---

## Instructions

Complete the following exercises using the `lubridate` and `purrr` packages in R. Ensure that your solutions are optimized and use functional programming principles where applicable.

1.  Load the necessary libraries.

    ```{r}
    #| title: set up
    library(lubridate)
    library(purrr)
    library(tidyverse)
    ```

2.  Answer each question in separate R code chunks.

## Exercise 1: Advanced Date Manipulation with lubridate

### Question 1:

Generate a sequence of dates from **January 1, 2015** to **December 31, 2025**, spaced by every **two months**. Extract the **year**, **quarter**, and **ISO week number** for each date.

```{r}
#| title: Question 1

two_month_sequence <- seq.Date(
  from = as.Date("2015-01-01"),
  to   = as.Date("2025-12-31"),
  by   = "2 months"
)
two_month_sequence

two_month_sequence_info <- tibble(date = two_month_sequence) |>
  mutate(
    year = year(date),
    quarter = quarter(date),
    iso_week = isoweek(date)
  )
two_month_sequence_info
```

## Exercise 2: Complex Date Arithmetic

### Question 2:

Given the following dates, compute the difference in **months** and **weeks** between each consecutive pair.

```{r}
#| title: Question 2 

sample_dates <- c("2018-03-15", "2020-07-20", "2023-01-10", "2025-09-05") 
dates <- ymd(sample_dates) 

map2_dfr( 
  dates[-length(dates)], 
          dates[-1], 
  ~ tibble(
    from = .x, 
    to = .y, 
    months_difference = interval(.x, .y) %/% months(1), weeks_difference = as.numeric(difftime(
      .y, 
      .x, 
      units = "weeks")) 
    ))
```

### Question 3:

-   Load the `wmata_ridership` data frame into R from <https://dcgerard.github.io/stat_412_612/data/wmata_ridership.csv>. For each month, calculate the proportion of rides made on a given day of the month. Then make box plots of the proportions of ridership vs day of the weak. But exclude any days from 2004 and 2005.

    ```{r}
    #| title: Question 3

    ridership_data <- read_csv("wmata_ridership.csv")

    ridership_clean <- ridership_data |>
      mutate(
        year  = year(Date),
        month = floor_date(Date, "month"),
        day   = day(Date),
        weekday = wday(Date, label = TRUE)
      ) |>
      filter(!year %in% c(2004, 2005))

    monthly_proportions <- ridership_clean |>
      group_by(month) |>
      mutate(
        monthly_total = sum(Total),
        monthly_proportion = Total / monthly_total
      ) |>
      ungroup()

    ggplot(monthly_proportions, aes(x = weekday, y = monthly_proportion)) +
      geom_boxplot() +
      labs(
        title = "Monthly Ridership Proportions by Day of the Week",
        x = "Day of the Week",
        y = "Proportion of Monthly Rides"
      ) +
      theme_bw()
    ```

### Question 4:

-   Write only one line of the code to return only the leap years for years 2024, 3021, 2000 or 1800, 800, 5050, 600 and 7156.

```{r}
#| title: Question 4

c(2024, 3021, 2000, 1800, 800, 5050, 600, 7156)[lubridate::leap_year(c(2024, 3021, 2000, 1800, 800, 5050, 600, 7156))]
```
